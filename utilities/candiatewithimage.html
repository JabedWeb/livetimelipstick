<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find My Reps</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
    }
    input {
      padding: 8px;
      width: 200px;
      margin-right: 10px;
    }
    button {
      padding: 8px 16px;
    }
    .rep-card {
      display: flex;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
    }
    .rep-card img {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      margin-right: 20px;
      object-fit: cover;
    }
    .rep-details {
      flex: 1;
    }
  </style>
</head>
<body>
  <h2>Enter State Abbreviation (e.g., CA)</h2>
  <input type="text" id="state" placeholder="e.g. WA" />
  <button onclick="fetchRepsByState()">Find Reps</button>
  <div id="output"></div>

  <script>
    async function fetchRepsByState() {
      const state = document.getElementById('state').value.trim().toUpperCase();
      const output = document.getElementById('output');
      output.innerHTML = 'Loading...';

      try {
        const legislatorsRes = await fetch('https://unitedstates.github.io/congress-legislators/legislators-current.json');
        const legislators = await legislatorsRes.json();

        const socialRes = await fetch('https://unitedstates.github.io/congress-legislators/legislators-social-media.json');
        const socials = await socialRes.json();

        const reps = legislators.filter(leg => leg.terms.some(term => term.state === state));

        if (!reps.length) {
          output.innerHTML = 'No representatives found for this state.';
          return;
        }

        output.innerHTML = '';
        reps.forEach(rep => {
          const latestTerm = rep.terms[rep.terms.length - 1];
          const name = rep.name.official_full;
          const party = latestTerm.party;
          const office = latestTerm.office || 'N/A';
          const phone = latestTerm.phone || 'N/A';
          const bioguideId = rep.id.bioguide;

          const social = socials.find(s => s.id.bioguide === bioguideId)?.social || {};

          const imageUrl = `https://bioguide.congress.gov/bioguide/photo/${bioguideId.charAt(0)}/${bioguideId}.jpg`;

          const card = document.createElement('div');
          card.className = 'rep-card';
          card.innerHTML = `
            <img src="${imageUrl}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}'" alt="${name}" />
            <div class="rep-details">
              <strong>${name}</strong><br>
              Party: ${party} <br>
              Office: ${office} <br>
              Phone: ${phone} <br>
              ${social.twitter ? `Twitter: <a href='https://twitter.com/${social.twitter}' target='_blank'>@${social.twitter}</a><br>` : ''}
              ${social.facebook ? `Facebook: <a href='https://facebook.com/${social.facebook}' target='_blank'>${social.facebook}</a><br>` : ''}
              ${social.instagram ? `Instagram: <a href='https://instagram.com/${social.instagram}' target='_blank'>@${social.instagram}</a><br>` : ''}
            </div>
          `;
          output.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        output.innerHTML = 'Something went wrong. Please try again later.';
      }
    }
  </script>
</body>
</html>
